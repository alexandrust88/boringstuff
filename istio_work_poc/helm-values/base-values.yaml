# Istio Base Helm Values
# This chart installs Istio CRDs and cluster-scoped resources

# Default revision for Istio (used for canary upgrades)
defaultRevision: default

# Global settings inherited by all Istio components
global:
  # ============================================
  # PHASE 2: Private Registry Configuration
  # Uncomment and update when moving to private registry
  # ============================================
  # hub: your-registry.example.com/istio
  # tag: "1.28.0"
  # imagePullSecrets:
  #   - name: your-registry-secret

  # Logging level for Istio components
  logging:
    level: "default:info"

  # ============================================
  # Default Security Context for All Components
  # These are inherited by istiod and gateways
  # ============================================

  # Proxy settings (affects sidecars)
  proxy:
    # Resource limits/requests for sidecars
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 2000m
        memory: 1024Mi

    # ============================================
    # Sidecar Proxy Security Context
    # ============================================
    # Run as non-root user (1337 is standard Istio proxy user)
    runAsUser: 1337
    runAsGroup: 1337
    runAsNonRoot: true

    # Privileged mode
    # Set to false when using Istio CNI plugin (recommended for security)
    # Set to true if NOT using CNI (requires init container with NET_ADMIN)
    privileged: false

    # Capabilities for the proxy container
    capabilities:
      drop:
        - ALL
      add:
        # Required for binding to ports < 1024 (e.g., 80, 443)
        - NET_BIND_SERVICE

    # Read-only root filesystem
    readOnlyRootFilesystem: true

    # Prevent privilege escalation
    allowPrivilegeEscalation: false

  # ============================================
  # Init Container Security Context
  # Used by istio-init when NOT using CNI plugin
  # ============================================
  proxy_init:
    # Resource limits for init container
    resources:
      limits:
        cpu: 2000m
        memory: 1024Mi
      requests:
        cpu: 10m
        memory: 10Mi

  # ============================================
  # Platform-specific Security Settings
  # ============================================
  # Set to "openshift" for OpenShift clusters
  # This adjusts security contexts for OpenShift's SCC
  platform: ""

  # ============================================
  # CNI Plugin Configuration
  # Using CNI plugin improves security by removing
  # the need for privileged init containers
  # ============================================
  # istio_cni:
  #   enabled: true
  #   chained: true

# ============================================
# Validation Webhook Security
# ============================================
# The base chart installs CRDs and validation webhooks
# Webhook security is managed by Istio automatically
