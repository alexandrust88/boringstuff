# Istio Ingress Gateway Helm Values

# Gateway name
name: istio-ingressgateway

# Number of gateway replicas
replicaCount: 1

# Auto-scaling configuration
autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80

# Service configuration
service:
  # Service type (LoadBalancer for cloud, NodePort for bare metal)
  type: LoadBalancer

  # Ports exposed by the gateway
  ports:
    - name: status-port
      port: 15021
      protocol: TCP
      targetPort: 15021
    - name: http2
      port: 80
      protocol: TCP
      targetPort: 80
    - name: https
      port: 443
      protocol: TCP
      targetPort: 443

  # Annotations for cloud load balancers (uncomment as needed)
  annotations: {}
    # AWS NLB example:
    # service.beta.kubernetes.io/aws-load-balancer-type: nlb
    # service.beta.kubernetes.io/aws-load-balancer-scheme: internet-facing

    # GCP example:
    # cloud.google.com/load-balancer-type: External

    # Azure example:
    # service.beta.kubernetes.io/azure-load-balancer-internal: "false"

# Resource limits
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 2000m
    memory: 1024Mi

# ============================================
# Security Context Configuration
# ============================================

# Pod-level security context
securityContext:
  # Run as non-root user (1337 is standard Istio user)
  runAsUser: 1337
  runAsGroup: 1337
  runAsNonRoot: true
  # Filesystem group for volume mounts
  fsGroup: 1337

# Container-level security context
containerSecurityContext:
  # Run as non-root
  runAsUser: 1337
  runAsGroup: 1337
  runAsNonRoot: true
  # Read-only root filesystem
  readOnlyRootFilesystem: true
  # Prevent privilege escalation
  allowPrivilegeEscalation: false
  # Drop all capabilities except required ones
  capabilities:
    drop:
      - ALL
    add:
      # Required for binding to privileged ports (80, 443)
      # Remove if using ports > 1024
      - NET_BIND_SERVICE
  # Seccomp profile (requires Kubernetes 1.19+)
  seccompProfile:
    type: RuntimeDefault

# Pod disruption budget
podDisruptionBudget:
  minAvailable: 1

# Node selector (optional)
nodeSelector: {}

# Tolerations (optional)
tolerations: []

# Affinity rules (optional)
affinity: {}

# Labels for the gateway pods
labels:
  app: istio-ingressgateway
  istio: ingressgateway

# ============================================
# Pod Annotations for Security
# ============================================
podAnnotations: {}
  # Example: Enable AppArmor profile
  # container.apparmor.security.beta.kubernetes.io/istio-proxy: runtime/default

# ============================================
# Service Account Configuration
# ============================================
serviceAccount:
  # Create a dedicated service account
  create: true
  # Annotations for the service account (e.g., for IAM roles)
  annotations: {}
    # AWS IRSA example:
    # eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT_ID:role/istio-gateway-role
    # GCP Workload Identity example:
    # iam.gke.io/gcp-service-account: istio-gateway@PROJECT_ID.iam.gserviceaccount.com

# ============================================
# PHASE 2: Private Registry Configuration
# Uncomment and update when moving to private registry
# ============================================
# global:
#   hub: your-registry.example.com/istio
#   tag: "1.28.0"
#   imagePullSecrets:
#     - name: your-registry-secret
